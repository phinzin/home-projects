<!-- Form th√™m/s·ª≠a c√¥ng vi·ªác -->
<div class="bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300"
     [class.border-t-4]="!isEditing()"
     [class.border-indigo-500]="!isEditing()"
     [class.border-2]="isEditing()"
     [class.border-amber-500]="isEditing()">

  <!-- Header - Always visible -->
  <div class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors"
       (click)="toggleFormExpand()">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center"
           [class]="isEditing() ? 'bg-amber-100' : 'bg-indigo-100'">
        <span class="text-xl">{{ isEditing() ? '‚úèÔ∏è' : '‚ûï' }}</span>
      </div>
      <div>
        <h2 class="text-lg font-semibold text-gray-800">
          {{ isEditing() ? 'Ch·ªânh s·ª≠a c√¥ng vi·ªác' : 'Th√™m C√¥ng Vi·ªác M·ªõi' }}
        </h2>
        <p class="text-sm text-gray-500">
          {{ isEditing() ? 'ƒêang ch·ªânh s·ª≠a: ' + taskName : 'Nh·∫•n ƒë·ªÉ th√™m c√¥ng vi·ªác b·∫£o tr√¨ m·ªõi' }}
        </p>
      </div>
    </div>
    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center transition-transform duration-300"
         [class.rotate-180]="isFormExpanded()">
      <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </div>
  </div>

  <!-- Expandable Form -->
  @if (isFormExpanded()) {
    <div class="p-6 pt-2 border-t border-gray-100 animate-slide-down">
      <form (submit)="submitTask($event)" class="space-y-4">

        <!-- Row 1: Task Name & Category -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- T√™n C√¥ng Vi·ªác -->
          <div class="md:col-span-2">
            <label for="taskName" class="block text-sm font-medium text-gray-700 mb-1">
              T√™n c√¥ng vi·ªác <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="taskName"
              [(ngModel)]="taskName"
              name="taskName"
              required
              placeholder="V√≠ d·ª•: Thay l√µi l·ªçc n∆∞·ªõc, Thay nh·ªõt xe..."
              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
            >
          </div>

          <!-- Danh m·ª•c -->
          <div>
            <label for="category" class="block text-sm font-medium text-gray-700 mb-1">
              Danh m·ª•c
            </label>
            <select
              id="category"
              [(ngModel)]="category"
              name="category"
              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
            >
              @for (cat of categories; track cat.value) {
                <option [value]="cat.value">{{ cat.icon }} {{ cat.label }}</option>
              }
            </select>
          </div>
        </div>

        <!-- Row 2: Period Type, Value, Unit -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Lo·∫°i ƒê·ªãnh K·ª≥ -->
          <div>
            <label for="periodType" class="block text-sm font-medium text-gray-700 mb-1">
              Lo·∫°i ƒë·ªãnh k·ª≥
            </label>
            <select
              id="periodType"
              [(ngModel)]="periodType"
              name="periodType"
              (ngModelChange)="updatePeriodUnit($event)"
              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
            >
              <option value="time">‚è∞ Th·ªùi gian</option>
              <option value="mileage">üöó S·ªë KM (ODO)</option>
            </select>
          </div>

          <!-- Gi√° tr·ªã ƒê·ªãnh K·ª≥ -->
          <div>
            <label for="periodValue" class="block text-sm font-medium text-gray-700 mb-1">
              Gi√° tr·ªã <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              id="periodValue"
              [(ngModel)]="periodValue"
              name="periodValue"
              required
              min="1"
              [placeholder]="isMileageType() ? 'V√≠ d·ª•: 5000' : 'V√≠ d·ª•: 3'"
              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
            >
          </div>

          <!-- ƒê∆°n v·ªã ƒê·ªãnh K·ª≥ -->
          <div>
            <label for="periodUnit" class="block text-sm font-medium text-gray-700 mb-1">
              ƒê∆°n v·ªã
            </label>
            <select
              id="periodUnit"
              [(ngModel)]="periodUnit"
              name="periodUnit"
              [disabled]="isMileageType()"
              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all disabled:bg-gray-100 disabled:cursor-not-allowed"
            >
              @if (isMileageType()) {
                <option value="km">KM</option>
              } @else {
                <option value="months">Th√°ng</option>
                <option value="days">Ng√†y</option>
              }
            </select>
          </div>
        </div>

        <!-- Row 3: Notes -->
        <div>
          <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">
            Ghi ch√∫ (t√πy ch·ªçn)
          </label>
          <textarea
            id="notes"
            [(ngModel)]="notes"
            name="notes"
            placeholder="Th√™m ghi ch√∫ v·ªÅ c√¥ng vi·ªác n√†y..."
            rows="2"
            class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none"
          ></textarea>
        </div>

        <!-- Actions -->
        <div class="flex gap-3 pt-2">
          @if (isEditing()) {
            <button
              type="button"
              (click)="cancelEdit()"
              class="flex-1 md:flex-none px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-colors"
            >
              H·ªßy
            </button>
          }
          <button
            type="submit"
            class="flex-1 py-3 px-6 font-semibold rounded-xl shadow-md transition-all duration-200 flex items-center justify-center gap-2"
            [class]="isEditing()
              ? 'bg-amber-500 text-white hover:bg-amber-600'
              : 'bg-indigo-600 text-white hover:bg-indigo-700'"
          >
            <span>{{ isEditing() ? 'üíæ L∆∞u thay ƒë·ªïi' : '‚ûï Th√™m c√¥ng vi·ªác' }}</span>
          </button>
        </div>
      </form>
    </div>
  }
</div>
